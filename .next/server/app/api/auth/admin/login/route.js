(()=>{var e={};e.id=2634,e.ids=[2634],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},23952:(e,t,r)=>{"use strict";r.d(t,{z:()=>s});var n=r(96330);let s=global.prisma||new n.PrismaClient({log:["error"]})},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},57833:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>h,routeModule:()=>x,serverHooks:()=>y,workAsyncStorage:()=>w,workUnitAsyncStorage:()=>f});var n={};r.r(n),r.d(n,{POST:()=>g});var s=r(42706),i=r(28203),a=r(45994),o=r(39187),u=r(65658),c=r(23952),l=r(99001),p=r(67695),d=r(87967);let m=u.Ik({login:u.Yj().min(1),password:u.Yj().min(6)});async function g(e){let t=e.headers.get("x-forwarded-for")?.split(",")[0]?.trim()||"local";if(!(0,d.i)(`admin_login:${t}`,20,6e4).ok)return o.NextResponse.json({error:"Too many attempts"},{status:429});let r=await e.json(),n=m.parse(r),s=await c.z.adminUser.findUnique({where:{login:n.login}});return s&&await (0,l.B)(n.password,s.passwordHash)?(await (0,p.Au)({adminId:String(s.id),login:s.login}),o.NextResponse.json({ok:!0})):o.NextResponse.json({error:"Invalid credentials"},{status:401})}let x=new s.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/auth/admin/login/route",pathname:"/api/auth/admin/login",filename:"route",bundlePath:"app/api/auth/admin/login/route"},resolvedPagePath:"/Users/mycomp/Documents/IT/Projects/wasabi/wasabi-sayt-2/app/api/auth/admin/login/route.ts",nextConfigOutput:"",userland:n}),{workAsyncStorage:w,workUnitAsyncStorage:f,serverHooks:y}=x;function h(){return(0,a.patchFetch)({workAsyncStorage:w,workUnitAsyncStorage:f})}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},67695:(e,t,r)=>{"use strict";r.d(t,{Au:()=>c,Or:()=>l,ZT:()=>d,ln:()=>p});var n=r(43008),s=r.n(n),i=r(44512);let a=process.env.ADMIN_COOKIE_NAME||"wasabi_admin_session";async function o(e){(await (0,i.UL)()).set(a,e,{httpOnly:!0,sameSite:"lax",secure:!0,path:"/"})}async function u(){(await (0,i.UL)()).set(a,"",{httpOnly:!0,sameSite:"lax",secure:!0,path:"/",maxAge:0})}async function c(e){let t=function(e){let t=process.env.ADMIN_JWT_SECRET;return s().sign(e,t,{expiresIn:"7d"})}({sub:e.adminId,login:e.login});await o(t)}async function l(){let e=await (0,i.UL)(),t=e.get(a)?.value;if(!t)return null;let r=function(e){try{let t=process.env.ADMIN_JWT_SECRET;return s().verify(e,t)}catch{return null}}(t);return r?{adminId:r.sub,login:r.login}:null}async function p(){await u()}async function d(){return l()}},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},87967:(e,t,r)=>{"use strict";r.d(t,{i:()=>s});let n=new Map;function s(e,t,r){let s=Date.now(),i=n.get(e);return!i||i.resetAt<s?(n.set(e,{count:1,resetAt:s+1e3*t}),{ok:!0,remaining:r-1}):i.count>=r?{ok:!1,remaining:0,retryAfterMs:i.resetAt-s}:(i.count+=1,n.set(e,i),{ok:!0,remaining:r-i.count})}},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{},99001:(e,t,r)=>{"use strict";r.d(t,{B:()=>a,E:()=>i});var n=r(58964),s=r.n(n);async function i(e){let t=await s().genSalt(10);return s().hash(e,t)}async function a(e,t){return s().compare(e,t)}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[638,5452,4512,3008,5658,8964],()=>r(57833));module.exports=n})();