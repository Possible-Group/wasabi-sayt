(()=>{var e={};e.id=9769,e.ids=[9769],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},23952:(e,t,r)=>{"use strict";r.d(t,{z:()=>n});var i=r(96330);let n=global.prisma||new i.PrismaClient({log:["error"]})},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},67695:(e,t,r)=>{"use strict";r.d(t,{Au:()=>l,Or:()=>p,ZT:()=>d,ln:()=>c});var i=r(43008),n=r.n(i),a=r(44512);let s=process.env.ADMIN_COOKIE_NAME||"wasabi_admin_session";async function o(e){(await (0,a.UL)()).set(s,e,{httpOnly:!0,sameSite:"lax",secure:!0,path:"/"})}async function u(){(await (0,a.UL)()).set(s,"",{httpOnly:!0,sameSite:"lax",secure:!0,path:"/",maxAge:0})}async function l(e){let t=function(e){let t=process.env.ADMIN_JWT_SECRET;return n().sign(e,t,{expiresIn:"7d"})}({sub:e.adminId,login:e.login});await o(t)}async function p(){let e=await (0,a.UL)(),t=e.get(s)?.value;if(!t)return null;let r=function(e){try{let t=process.env.ADMIN_JWT_SECRET;return n().verify(e,t)}catch{return null}}(t);return r?{adminId:r.sub,login:r.login}:null}async function c(){await u()}async function d(){return p()}},76516:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>f,routeModule:()=>h,serverHooks:()=>R,workAsyncStorage:()=>w,workUnitAsyncStorage:()=>v});var i={};r.r(i),r.d(i,{DELETE:()=>m,GET:()=>d,POST:()=>x});var n=r(42706),a=r(28203),s=r(45994),o=r(39187),u=r(65658),l=r(23952),p=r(67695);let c=u.Ik({id:u.ai().int().optional(),authorName:u.Yj().min(1),authorRole:u.Yj().optional(),titleRu:u.Yj().optional(),titleUz:u.Yj().optional(),textRu:u.Yj().optional(),textUz:u.Yj().optional(),rating:u.ai().int().min(1).max(5).optional(),photoUrl:u.Yj().optional(),publishedAt:u.Yj().optional(),sortOrder:u.ai().int().optional(),active:u.zM().optional()});async function d(){if(!await (0,p.ZT)())return o.NextResponse.json({error:"Unauthorized"},{status:401});let e=await l.z.review.findMany({orderBy:[{sortOrder:"asc"},{publishedAt:"desc"},{id:"desc"}]});return o.NextResponse.json(e)}async function x(e){if(!await (0,p.ZT)())return o.NextResponse.json({error:"Unauthorized"},{status:401});let t=c.parse(await e.json()),r=function(e){if(!e)return null;let t=new Date(e);return Number.isNaN(t.getTime())?null:t}(t.publishedAt),i=t.id?await l.z.review.update({where:{id:t.id},data:{authorName:t.authorName,authorRole:t.authorRole||null,titleRu:t.titleRu||null,titleUz:t.titleUz||null,textRu:t.textRu||null,textUz:t.textUz||null,rating:t.rating??5,photoUrl:t.photoUrl||null,publishedAt:r,sortOrder:t.sortOrder??0,active:t.active??!0}}):await l.z.review.create({data:{authorName:t.authorName,authorRole:t.authorRole||null,titleRu:t.titleRu||null,titleUz:t.titleUz||null,textRu:t.textRu||null,textUz:t.textUz||null,rating:t.rating??5,photoUrl:t.photoUrl||null,publishedAt:r,sortOrder:t.sortOrder??0,active:t.active??!0}});return o.NextResponse.json({ok:!0,row:i})}async function m(e){if(!await (0,p.ZT)())return o.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:t}=new URL(e.url),r=Number(t.get("id")||0);return r?(await l.z.review.delete({where:{id:r}}),o.NextResponse.json({ok:!0})):o.NextResponse.json({error:"Missing id"},{status:400})}let h=new n.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/admin/reviews/route",pathname:"/api/admin/reviews",filename:"route",bundlePath:"app/api/admin/reviews/route"},resolvedPagePath:"/Users/mycomp/Documents/IT/Projects/wasabi/wasabi-sayt-2/app/api/admin/reviews/route.ts",nextConfigOutput:"",userland:i}),{workAsyncStorage:w,workUnitAsyncStorage:v,serverHooks:R}=h;function f(){return(0,s.patchFetch)({workAsyncStorage:w,workUnitAsyncStorage:v})}},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[638,5452,4512,3008,5658],()=>r(76516));module.exports=i})();