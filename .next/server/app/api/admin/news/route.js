(()=>{var e={};e.id=2819,e.ids=[2819],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},23952:(e,t,r)=>{"use strict";r.d(t,{z:()=>i});var s=r(96330);let i=global.prisma||new s.PrismaClient({log:["error"]})},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},63492:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>j,routeModule:()=>w,serverHooks:()=>z,workAsyncStorage:()=>x,workUnitAsyncStorage:()=>y});var s={};r.r(s),r.d(s,{DELETE:()=>U,GET:()=>m,POST:()=>R});var i=r(42706),n=r(28203),o=r(45994),u=r(39187),a=r(65658),l=r(23952),p=r(67695);let c=a.Ik({id:a.ai().int().optional(),slug:a.Yj().min(1),imageUrl:a.Yj().min(1),titleRu:a.Yj().min(1),titleUz:a.Yj().min(1),excerptRu:a.Yj().min(1),excerptUz:a.Yj().min(1),bodyRu:a.Yj().min(1),bodyUz:a.Yj().min(1),seoTitleRu:a.Yj().optional(),seoDescriptionRu:a.Yj().optional(),seoKeywordsRu:a.Yj().optional(),seoTitleUz:a.Yj().optional(),seoDescriptionUz:a.Yj().optional(),seoKeywordsUz:a.Yj().optional(),publishedAt:a.Yj().optional(),active:a.zM().optional()});function d(e){return"string"==typeof e?e.trim():""}async function m(){if(!await (0,p.ZT)())return u.NextResponse.json({error:"Unauthorized"},{status:401});let e=await l.z.newsItem.findMany({orderBy:[{publishedAt:"desc"},{createdAt:"desc"},{id:"desc"}]});return u.NextResponse.json(e)}async function R(e){if(!await (0,p.ZT)())return u.NextResponse.json({error:"Unauthorized"},{status:401});let t=c.parse(await e.json()),r=function(e){if(!e)return null;let t=new Date(e);return Number.isNaN(t.getTime())?null:t}(t.publishedAt),s=d(t.slug).toLowerCase().replace(/[^\p{L}\p{N}\s-]+/gu,"").replace(/\s+/g,"-").replace(/-+/g,"-");if(!s)return u.NextResponse.json({error:"INVALID_SLUG"},{status:400});try{let e=t.id?await l.z.newsItem.update({where:{id:t.id},data:{slug:s,imageUrl:d(t.imageUrl),titleRu:d(t.titleRu),titleUz:d(t.titleUz),excerptRu:d(t.excerptRu),excerptUz:d(t.excerptUz),bodyRu:d(t.bodyRu),bodyUz:d(t.bodyUz),seoTitleRu:d(t.seoTitleRu)||null,seoDescriptionRu:d(t.seoDescriptionRu)||null,seoKeywordsRu:d(t.seoKeywordsRu)||null,seoTitleUz:d(t.seoTitleUz)||null,seoDescriptionUz:d(t.seoDescriptionUz)||null,seoKeywordsUz:d(t.seoKeywordsUz)||null,publishedAt:r,active:t.active??!0}}):await l.z.newsItem.create({data:{slug:s,imageUrl:d(t.imageUrl),titleRu:d(t.titleRu),titleUz:d(t.titleUz),excerptRu:d(t.excerptRu),excerptUz:d(t.excerptUz),bodyRu:d(t.bodyRu),bodyUz:d(t.bodyUz),seoTitleRu:d(t.seoTitleRu)||null,seoDescriptionRu:d(t.seoDescriptionRu)||null,seoKeywordsRu:d(t.seoKeywordsRu)||null,seoTitleUz:d(t.seoTitleUz)||null,seoDescriptionUz:d(t.seoDescriptionUz)||null,seoKeywordsUz:d(t.seoKeywordsUz)||null,publishedAt:r,active:t.active??!0}});return u.NextResponse.json({ok:!0,row:e})}catch(e){if("P2002"===(e&&"object"==typeof e&&"code"in e?e.code:""))return u.NextResponse.json({error:"SLUG_TAKEN"},{status:409});return u.NextResponse.json({error:"SAVE_FAILED"},{status:500})}}async function U(e){if(!await (0,p.ZT)())return u.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:t}=new URL(e.url),r=Number(t.get("id")||0);return r?(await l.z.newsItem.delete({where:{id:r}}),u.NextResponse.json({ok:!0})):u.NextResponse.json({error:"Missing id"},{status:400})}let w=new i.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/admin/news/route",pathname:"/api/admin/news",filename:"route",bundlePath:"app/api/admin/news/route"},resolvedPagePath:"/Users/mycomp/Documents/IT/Projects/wasabi/wasabi-sayt-2/app/api/admin/news/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:x,workUnitAsyncStorage:y,serverHooks:z}=w;function j(){return(0,o.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:y})}},67695:(e,t,r)=>{"use strict";r.d(t,{Au:()=>l,Or:()=>p,ZT:()=>d,ln:()=>c});var s=r(43008),i=r.n(s),n=r(44512);let o=process.env.ADMIN_COOKIE_NAME||"wasabi_admin_session";async function u(e){(await (0,n.UL)()).set(o,e,{httpOnly:!0,sameSite:"lax",secure:!0,path:"/"})}async function a(){(await (0,n.UL)()).set(o,"",{httpOnly:!0,sameSite:"lax",secure:!0,path:"/",maxAge:0})}async function l(e){let t=function(e){let t=process.env.ADMIN_JWT_SECRET;return i().sign(e,t,{expiresIn:"7d"})}({sub:e.adminId,login:e.login});await u(t)}async function p(){let e=await (0,n.UL)(),t=e.get(o)?.value;if(!t)return null;let r=function(e){try{let t=process.env.ADMIN_JWT_SECRET;return i().verify(e,t)}catch{return null}}(t);return r?{adminId:r.sub,login:r.login}:null}async function c(){await a()}async function d(){return p()}},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[638,5452,4512,3008,5658],()=>r(63492));module.exports=s})();