(()=>{var e={};e.id=2413,e.ids=[2413],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9875:(e,r,t)=>{"use strict";t.d(r,{FH:()=>p,rY:()=>o,wK:()=>c});var s=t(79748),n=t(33873),i=t.n(n);let a=(()=>{let e=process.env.UPLOADS_DIR,r=e?i().resolve(e):i().join(process.cwd(),"public","uploads");return r.endsWith(i().sep)?r:`${r}${i().sep}`})();function u(...e){let r=i().normalize(i().join(a,...e));if(!r.startsWith(a))throw Error("Invalid upload path");return r}async function o(e,r,t){let n=u(e);await (0,s.mkdir)(n,{recursive:!0});let a=i().join(n,r);return await (0,s.writeFile)(a,t),a}function p(e,r){let t=e.replace(/^\/+|\/+$/g,"");return`/uploads/${t}/${r}`}function c(e){if(!Array.isArray(e)||0===e.length)throw Error("Missing path");return u(...e)}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33873:e=>{"use strict";e.exports=require("path")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55146:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>g,routeModule:()=>w,serverHooks:()=>y,workAsyncStorage:()=>x,workUnitAsyncStorage:()=>v});var s={};t.r(s),t.d(s,{POST:()=>m,runtime:()=>f});var n=t(42706),i=t(28203),a=t(45994),u=t(39187),o=t(55511),p=t(67695),c=t(33873),l=t.n(c),d=t(9875);let f="nodejs";async function m(e){if(!await (0,p.ZT)())return u.NextResponse.json({error:"Unauthorized"},{status:401});let r=(await e.formData()).get("file");if(!(r instanceof File))return u.NextResponse.json({error:"Missing file"},{status:400});let t=await r.arrayBuffer(),s=Buffer.from(t),n=l().extname(r.name||"").slice(1),i=n?`.${n}`:".jpg",a=`${Date.now()}-${(0,o.randomUUID)()}${i}`;return await (0,d.rY)("news",a,s),u.NextResponse.json({url:(0,d.FH)("news",a)})}let w=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/admin/news/upload/route",pathname:"/api/admin/news/upload",filename:"route",bundlePath:"app/api/admin/news/upload/route"},resolvedPagePath:"/Users/mycomp/Documents/IT/Projects/wasabi/wasabi-sayt-2/app/api/admin/news/upload/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:x,workUnitAsyncStorage:v,serverHooks:y}=w;function g(){return(0,a.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:v})}},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},67695:(e,r,t)=>{"use strict";t.d(r,{Au:()=>p,Or:()=>c,ZT:()=>d,ln:()=>l});var s=t(43008),n=t.n(s),i=t(44512);let a=process.env.ADMIN_COOKIE_NAME||"wasabi_admin_session";async function u(e){(await (0,i.UL)()).set(a,e,{httpOnly:!0,sameSite:"lax",secure:!0,path:"/"})}async function o(){(await (0,i.UL)()).set(a,"",{httpOnly:!0,sameSite:"lax",secure:!0,path:"/",maxAge:0})}async function p(e){let r=function(e){let r=process.env.ADMIN_JWT_SECRET;return n().sign(e,r,{expiresIn:"7d"})}({sub:e.adminId,login:e.login});await u(r)}async function c(){let e=await (0,i.UL)(),r=e.get(a)?.value;if(!r)return null;let t=function(e){try{let r=process.env.ADMIN_JWT_SECRET;return n().verify(e,r)}catch{return null}}(r);return t?{adminId:t.sub,login:t.login}:null}async function l(){await o()}async function d(){return c()}},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},79748:e=>{"use strict";e.exports=require("fs/promises")},96487:()=>{}};var r=require("../../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[638,5452,4512,3008],()=>t(55146));module.exports=s})();