(()=>{var e={};e.id=8984,e.ids=[8984],e.modules={2381:(e,r,t)=>{"use strict";function i(e){return null==e?null:String(e).trim()||null}function o(e,r){if(!e||"object"!=typeof e)return e;let t=i(e.category_id??e.categoryId??e.product_category_id??e.productCategoryId??e.category?.category_id??e.category?.id??r);return t?{...e,category_id:t}:e}function n(e){let r=(function(e){let r=e?.response;if(Array.isArray(r))return r;if(Array.isArray(r?.products))return r.products;if(Array.isArray(r?.items))return r.items;let t=(e,r)=>{let t=i(e?.category_id??e?.categoryId??e?.id??e?.category?.category_id??r);return Array.isArray(e?.products)?e.products.map(e=>o(e,t)):Array.isArray(e?.items)?e.items.map(e=>o(e,t)):[]};if(Array.isArray(r?.categories)){let e=r.categories.flatMap(e=>t(e));if(e.length)return e}if(r?.categories&&"object"==typeof r.categories){let e=Object.entries(r.categories).flatMap(([e,r])=>t(r,e));if(e.length)return e}if(r?.products&&"object"==typeof r.products){let e=Object.entries(r.products).flatMap(([e,r])=>Array.isArray(r)?r.map(r=>o(r,e)):Array.isArray(r?.products)?r.products.map(r=>o(r,e)):Array.isArray(r?.items)?r.items.map(r=>o(r,e)):[o(r,e)]);if(e.length)return e}if(r&&"object"==typeof r){let e=Object.values(r).flatMap(e=>Array.isArray(e)?e:[]);if(e.length)return e}return[]})(e).filter(e=>e&&(e.product_id||e.id||e.product_name||e.name)),t=process.env.POSTER_BASE_URL,n="";if(t)try{n=new URL(t).origin}catch{n=""}let a=e=>{let r="string"==typeof e?e.trim():"";return r?r.startsWith("/")&&n?`${n}${r}`:r:null};return r.map(e=>{let r=[e.photo_origin,e.photoOrigin,e.photo_big_origin,e.photoBigOrigin,e.photo_big,e.photoBig,e.photo_large,e.photoLarge,e.photo,e.image].find(e=>"string"==typeof e&&e.trim())||null,t=e.photo??null,i=r||t||null;return{product_id:String(e.product_id??e.id??""),product_name:function(e){let r="string"==typeof e?e.trim():"";if(!r)return"";let t=r.indexOf("$");return t>=0?r.slice(0,t).trim():r}(e.product_name??e.name??""),price:function(e){for(let r of[e?.price?.[1],e?.price?.["1"],e?.price,e?.product_price,e?.price_sum,e?.price_1,e?.price1,e?.price2,e?.price3,e?.price4,e?.price5,e?.price6,e?.price7,e?.price8,e?.price9,e?.prices]){let e=function e(r){if(null==r)return null;if("number"==typeof r)return Number.isFinite(r)?r:null;if("string"==typeof r){let e=Number(r.replace(/\s+/g,"").replace(",",".").replace(/[^0-9.-]/g,""));return Number.isFinite(e)?e:null}if(Array.isArray(r)){for(let t of r){let r=e(t);if(r&&r>0)return r}return null}if("object"==typeof r){for(let t of[r.price,r.value,r.sum,r.amount]){let r=e(t);if(r&&r>0)return r}for(let t of Object.values(r)){let r=e(t);if(r&&r>0)return r}}return null}(r);if(e&&e>0)return e}return 0}(e),photo:a(i),photo_origin:a(r),photo_raw:t,ingredients:e.ingredients??null,description:e.description??null,category_name:e.category_name??e.menu_category_name??e.category?.category_name??e.category?.name??null,category_id:e.category_id?String(e.category_id):e.menu_category_id?String(e.menu_category_id):e.menuCategoryId?String(e.menuCategoryId):e.categoryId?String(e.categoryId):e.category?.category_id?String(e.category.category_id):e.category?.id?String(e.category.id):e.product_category_id?String(e.product_category_id):e.productCategoryId?String(e.productCategoryId):null}})}t.d(r,{E:()=>n})},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},23952:(e,r,t)=>{"use strict";t.d(r,{z:()=>o});var i=t(96330);let o=global.prisma||new i.PrismaClient({log:["error"]})},27146:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>h,routeModule:()=>y,serverHooks:()=>_,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>m});var i={};t.r(i),t.d(i,{GET:()=>g,dynamic:()=>d});var o=t(42706),n=t(28203),a=t(45994),s=t(39187),c=t(39676),u=t(2381),p=t(23952),l=t(67695);let d="force-dynamic";async function g(e){let{searchParams:r}=new URL(e.url),t=r.get("category_id")||void 0,i="1"===r.get("include_hidden");if(i&&!await (0,l.ZT)())return s.NextResponse.json({error:"Unauthorized"},{status:401});let o=await (0,c.i)("menu.getProducts",{category_id:t}),n=(0,u.E)(o);if(!t&&0===n.length){let e=await (0,c.i)("menu.getCategories"),r=(Array.isArray(e?.response)&&e.response||Array.isArray(e?.categories)&&e.categories||[]).map(e=>String(e?.category_id??e?.id??"").trim()).filter(Boolean);n=(await Promise.all(r.map(e=>(0,c.i)("menu.getProducts",{category_id:e}).catch(()=>null)))).flatMap((e,t)=>{if(!e)return[];let i=(0,u.E)(e);if(!i.length)return[];let o=r[t];return i.map(e=>e.category_id?e:{...e,category_id:o})})}if(!i){let e=await p.z.productTranslation.findMany({where:{hidden:!0},select:{productId:!0}});if(e.length){let r=new Set(e.map(e=>e.productId));return s.NextResponse.json(n.filter(e=>!r.has(String(e.product_id??e.id??""))))}}return s.NextResponse.json(n)}let y=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/poster/products/route",pathname:"/api/poster/products",filename:"route",bundlePath:"app/api/poster/products/route"},resolvedPagePath:"/Users/mycomp/Documents/IT/Projects/wasabi/wasabi-sayt-2/app/api/poster/products/route.ts",nextConfigOutput:"",userland:i}),{workAsyncStorage:f,workUnitAsyncStorage:m,serverHooks:_}=y;function h(){return(0,a.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:m})}},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},39676:(e,r,t)=>{"use strict";t.d(r,{i:()=>a});let i=process.env.POSTER_TOKEN||process.env.POSTER_ACCESS_TOKEN,o=process.env.POSTER_BASE_URL;function n(e,r){if(!r)throw Error(`Missing env ${e}`);return r}async function a(e,r={},t={}){let s=n("POSTER_TOKEN",i),c=n("POSTER_BASE_URL",o).replace(/\/$/,""),u=t.httpMethod??"GET",p=new URL(`${c}/${e}`);p.searchParams.set("token",s),p.searchParams.set("format","json");let l={cache:"no-store",method:u};if("GET"===u)for(let[e,t]of Object.entries(r))void 0!==t&&p.searchParams.set(e,String(t));else{let e=new URLSearchParams;for(let[t,i]of Object.entries(r))void 0!==i&&e.set(t,String(i));l.headers={"content-type":"application/x-www-form-urlencoded;charset=UTF-8"},l.body=e.toString()}let d=await fetch(p.toString(),l),g=await d.text().catch(()=>"");if(!d.ok)throw Error(`Poster error ${d.status}: ${g||d.statusText}`);let y=g?JSON.parse(g):{};if(y?.error){let e="object"==typeof y.error?JSON.stringify(y.error):String(y.error),r=y?.message?` ${y.message}`:"";throw Error(`Poster API error: ${e}${r}`)}return y}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},55511:e=>{"use strict";e.exports=require("crypto")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},67695:(e,r,t)=>{"use strict";t.d(r,{Au:()=>u,Or:()=>p,ZT:()=>d,ln:()=>l});var i=t(43008),o=t.n(i),n=t(44512);let a=process.env.ADMIN_COOKIE_NAME||"wasabi_admin_session";async function s(e){(await (0,n.UL)()).set(a,e,{httpOnly:!0,sameSite:"lax",secure:!0,path:"/"})}async function c(){(await (0,n.UL)()).set(a,"",{httpOnly:!0,sameSite:"lax",secure:!0,path:"/",maxAge:0})}async function u(e){let r=function(e){let r=process.env.ADMIN_JWT_SECRET;return o().sign(e,r,{expiresIn:"7d"})}({sub:e.adminId,login:e.login});await s(r)}async function p(){let e=await (0,n.UL)(),r=e.get(a)?.value;if(!r)return null;let t=function(e){try{let r=process.env.ADMIN_JWT_SECRET;return o().verify(e,r)}catch{return null}}(r);return t?{adminId:t.sub,login:t.login}:null}async function l(){await c()}async function d(){return p()}},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},96330:e=>{"use strict";e.exports=require("@prisma/client")},96487:()=>{}};var r=require("../../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),i=r.X(0,[638,5452,4512,3008],()=>t(27146));module.exports=i})();