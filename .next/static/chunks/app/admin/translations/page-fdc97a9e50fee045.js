(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[359],{2944:(e,a,s)=>{Promise.resolve().then(s.bind(s,5917))},5299:(e,a,s)=>{"use strict";s.d(a,{A:()=>l,r:()=>i});let i="admin-toast";function l(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2400;window.dispatchEvent(new CustomEvent(i,{detail:{message:e,tone:a,duration:s}}))}},5917:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>c});var i=s(5155),l=s(2115),t=s(5299);function n(e){return"string"==typeof e?e.trim():""}function d(e){let{page:a,totalPages:s,onPage:l}=e;if(s<=1)return null;let t=function(e,a){if(a<=7)return Array.from({length:a},(e,a)=>a+1);let s=[1];e>3&&s.push("ellipsis");let i=Math.max(2,e-1),l=Math.min(a-1,e+1);for(let e=i;e<=l;e+=1)s.push(e);return e<a-2&&s.push("ellipsis"),s.push(a),s}(a,s);return(0,i.jsxs)("div",{className:"admin-pagination",children:[(0,i.jsx)("button",{className:"admin-page-btn",disabled:a<=1,onClick:()=>l(a-1),children:"Назад"}),t.map((e,s)=>"ellipsis"===e?(0,i.jsx)("span",{className:"admin-page-ellipsis",children:"..."},"ellipsis-".concat(s)):(0,i.jsx)("button",{className:"admin-page-btn".concat(e===a?" active":""),onClick:()=>l(e),children:e},e)),(0,i.jsx)("button",{className:"admin-page-btn",disabled:a>=s,onClick:()=>l(a+1),children:"Вперед"})]})}function c(){let[e,a]=(0,l.useState)(""),[s,c]=(0,l.useState)(1),[r,o]=(0,l.useState)([]),[m,u]=(0,l.useState)({}),[h,p]=(0,l.useState)({}),[v,x]=(0,l.useState)(null);(0,l.useEffect)(()=>{fetch("/api/poster/products?include_hidden=1").then(e=>e.json()).then(o),fetch("/api/poster/categories").then(e=>e.json()).then(e=>{let a={};e.forEach(e=>{var s,i,l;let t=n(null!==(s=e.category_id)&&void 0!==s?s:""),d=n(null!==(l=null!==(i=e.category_name)&&void 0!==i?i:e.name)&&void 0!==l?l:"");t&&(a[t]=d||t)}),u(a)}),fetch("/api/admin/product-translations").then(e=>e.json()).then(e=>{let a={};e.forEach(e=>a[e.productId]=e),p(a)})},[]),(0,l.useEffect)(()=>{c(1)},[e]);let j=(0,l.useMemo)(()=>{let a=e.trim().toLowerCase();return a?r.filter(e=>{var s;return n(null!==(s=e.product_name)&&void 0!==s?s:"").toLowerCase().includes(a)}):r},[r,e]),g=Math.max(1,Math.ceil(j.length/80));(0,l.useEffect)(()=>{s>g&&c(g)},[s,g]);let N=(0,l.useMemo)(()=>{let e=(s-1)*80;return j.slice(e,e+80)},[j,s]);function f(e,a){p(s=>({...s,[e]:{...s[e]||{productId:e},...a}}))}async function U(e){x(e);try{var a;let s=h[e]||{productId:e},i=await fetch("/api/admin/product-translations",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({productId:e,nameUz:s.nameUz||"",descUz:s.descUz||"",seoTitleRu:s.seoTitleRu||"",seoDescRu:s.seoDescRu||"",seoKeywordsRu:s.seoKeywordsRu||"",seoTitleUz:s.seoTitleUz||"",seoDescUz:s.seoDescUz||"",seoKeywordsUz:s.seoKeywordsUz||"",hidden:null!==(a=s.hidden)&&void 0!==a&&a})}),l=await i.json().catch(()=>null);if(!i.ok){(0,t.A)((null==l?void 0:l.error)||"Ошибка сохранения","error");return}(null==l?void 0:l.row)&&p(a=>({...a,[e]:l.row})),(0,t.A)("Перевод сохранен")}catch(e){(0,t.A)("Ошибка сохранения","error")}finally{x(null)}}return(0,i.jsxs)("div",{className:"admin-container stack-lg",children:[(0,i.jsxs)("div",{className:"stack",children:[(0,i.jsx)("h1",{className:"admin-title",children:"Переводы RU - UZ"}),(0,i.jsx)("p",{className:"admin-subtitle",children:"Русские данные берутся из Poster. Заполняйте переводы и SEO для RU и UZ."})]}),(0,i.jsxs)("div",{className:"admin-inline",children:[(0,i.jsx)("input",{className:"admin-input",placeholder:"Поиск товара (RU)…",value:e,onChange:e=>a(e.target.value),style:{flex:1,minWidth:260}}),(0,i.jsxs)("div",{className:"admin-pill",children:["Всего: ",j.length]})]}),(0,i.jsx)(d,{page:s,totalPages:g,onPage:c}),(0,i.jsx)("div",{className:"stack",children:N.map(e=>{var a,s,l,t;let d=String(null!==(a=e.product_id)&&void 0!==a?a:""),c=n(null!==(s=e.product_name)&&void 0!==s?s:""),r=n(null!==(t=null!==(l=e.ingredients)&&void 0!==l?l:e.description)&&void 0!==t?t:""),o=e.category_id?m[e.category_id]:"",u=e.photo_origin||e.photo||e.photo_raw||"",p=h[d]||{productId:d};return(0,i.jsxs)("div",{className:"admin-card stack",children:[(0,i.jsxs)("div",{className:"admin-inline",children:[(0,i.jsxs)("div",{className:"admin-subtitle",children:["ID: ",d]}),o&&(0,i.jsx)("div",{className:"admin-pill",children:o}),(0,i.jsxs)("label",{className:"admin-inline",style:{marginLeft:"auto",gap:8},children:[(0,i.jsx)("input",{type:"checkbox",checked:!!p.hidden,onChange:e=>f(d,{hidden:e.target.checked})}),(0,i.jsx)("span",{className:"admin-subtitle",children:"Скрыть на сайте"})]})]}),(0,i.jsxs)("div",{className:"admin-grid",children:[(0,i.jsxs)("div",{className:"admin-card stack",style:{boxShadow:"none"},children:[(0,i.jsx)("div",{style:{fontWeight:600},children:"RU (из Poster)"}),(0,i.jsxs)("div",{className:"admin-media",children:[(0,i.jsx)("div",{className:"admin-thumb",children:u?(0,i.jsx)("img",{src:u,alt:c,loading:"lazy"}):(0,i.jsx)("div",{className:"admin-thumb__empty",children:"Нет фото"})}),(0,i.jsxs)("div",{className:"stack",style:{flex:1},children:[(0,i.jsx)("div",{style:{fontWeight:600},children:c||"Без названия"}),(0,i.jsxs)("div",{className:"admin-subtitle",children:["Категория: ",o||e.category_id||"-"]}),(0,i.jsx)("div",{className:"admin-subtitle",style:{whiteSpace:"pre-wrap"},children:r||"Описание отсутствует"})]})]})]}),(0,i.jsxs)("div",{className:"admin-card stack",style:{boxShadow:"none"},children:[(0,i.jsx)("div",{style:{fontWeight:600},children:"UZ (заполняем)"}),(0,i.jsxs)("label",{className:"admin-field",children:["Название (UZ)",(0,i.jsx)("input",{className:"admin-input",placeholder:"Название (UZ)",value:p.nameUz||"",onChange:e=>f(d,{nameUz:e.target.value})})]}),(0,i.jsxs)("label",{className:"admin-field",children:["Описание (UZ)",(0,i.jsx)("textarea",{className:"admin-textarea",placeholder:"Описание (UZ)",value:p.descUz||"",onChange:e=>f(d,{descUz:e.target.value})})]}),(0,i.jsx)("div",{className:"admin-divider"}),(0,i.jsx)("div",{style:{fontWeight:600},children:"SEO (RU)"}),(0,i.jsxs)("label",{className:"admin-field",children:["Meta title (RU)",(0,i.jsx)("input",{className:"admin-input",placeholder:"Meta title (RU)",value:p.seoTitleRu||"",onChange:e=>f(d,{seoTitleRu:e.target.value})})]}),(0,i.jsxs)("label",{className:"admin-field",children:["Meta description (RU)",(0,i.jsx)("textarea",{className:"admin-textarea",placeholder:"Meta description (RU)",value:p.seoDescRu||"",onChange:e=>f(d,{seoDescRu:e.target.value})})]}),(0,i.jsxs)("label",{className:"admin-field",children:["Meta keywords (RU)",(0,i.jsx)("input",{className:"admin-input",placeholder:"ключ1, ключ2, ключ3",value:p.seoKeywordsRu||"",onChange:e=>f(d,{seoKeywordsRu:e.target.value})})]}),(0,i.jsx)("div",{className:"admin-divider"}),(0,i.jsx)("div",{style:{fontWeight:600},children:"SEO (UZ)"}),(0,i.jsxs)("label",{className:"admin-field",children:["Meta title (UZ)",(0,i.jsx)("input",{className:"admin-input",placeholder:"Meta title (UZ)",value:p.seoTitleUz||"",onChange:e=>f(d,{seoTitleUz:e.target.value})})]}),(0,i.jsxs)("label",{className:"admin-field",children:["Meta description (UZ)",(0,i.jsx)("textarea",{className:"admin-textarea",placeholder:"Meta description (UZ)",value:p.seoDescUz||"",onChange:e=>f(d,{seoDescUz:e.target.value})})]}),(0,i.jsxs)("label",{className:"admin-field",children:["Meta keywords (UZ)",(0,i.jsx)("input",{className:"admin-input",placeholder:"kalit1, kalit2, kalit3",value:p.seoKeywordsUz||"",onChange:e=>f(d,{seoKeywordsUz:e.target.value})})]}),(0,i.jsx)("button",{className:"admin-button",style:{width:"100%"},disabled:v===d,onClick:()=>U(d),children:v===d?"...":"Сохранить"})]})]})]},d)})}),(0,i.jsx)(d,{page:s,totalPages:g,onPage:c}),(0,i.jsxs)("div",{className:"admin-subtitle",children:["Пагинация по ",80," товаров на страницу."]})]})}}},e=>{var a=a=>e(e.s=a);e.O(0,[8441,6587,7358],()=>a(2944)),_N_E=e.O()}]);