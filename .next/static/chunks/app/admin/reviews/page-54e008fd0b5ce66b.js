(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6160],{714:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>d});var i=t(5155),l=t(2115),s=t(5299);function n(e){let a=Number(e);return Number.isFinite(a)?Math.min(5,Math.max(1,Math.round(a))):1}function d(){let[e,a]=(0,l.useState)([]),[t,d]=(0,l.useState)(null),[r,c]=(0,l.useState)(null),[o,u]=(0,l.useState)(!1),[m,h]=(0,l.useState)({authorName:"",authorRole:"",titleRu:"",titleUz:"",textRu:"",textUz:"",rating:5,photoUrl:"",publishedAt:"",sortOrder:0,active:!0});(0,l.useEffect)(()=>{fetch("/api/admin/reviews").then(e=>e.json()).then(a)},[]);let x=(0,l.useMemo)(()=>e.slice().sort((e,a)=>e.sortOrder-a.sortOrder||a.id-e.id),[e]);function v(e,t){a(a=>a.map(a=>a.id===e?{...a,...t}:a))}async function p(e){d(e.id);try{var t;let i=await fetch("/api/admin/reviews",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({id:e.id,authorName:e.authorName,authorRole:e.authorRole||"",titleRu:e.titleRu||"",titleUz:e.titleUz||"",textRu:e.textRu||"",textUz:e.textUz||"",rating:n(null!==(t=e.rating)&&void 0!==t?t:5),photoUrl:e.photoUrl||"",publishedAt:e.publishedAt||"",sortOrder:Number.isFinite(e.sortOrder)?e.sortOrder:0,active:e.active})}),l=await i.json().catch(()=>null);if(!i.ok){(0,s.A)((null==l?void 0:l.error)||"Ошибка сохранения","error");return}(null==l?void 0:l.row)&&a(a=>a.map(a=>a.id===e.id?l.row:a)),(0,s.A)("Отзыв сохранен")}catch(e){(0,s.A)("Ошибка сохранения","error")}finally{d(null)}}async function N(e){try{let t=await fetch("/api/admin/reviews?id=".concat(e),{method:"DELETE"}),i=await t.json().catch(()=>null);if(!t.ok){(0,s.A)((null==i?void 0:i.error)||"Ошибка удаления","error");return}a(a=>a.filter(a=>a.id!==e)),(0,s.A)("Отзыв удален")}catch(e){(0,s.A)("Ошибка удаления","error")}}async function j(){if(m.authorName)try{var e;let t=await fetch("/api/admin/reviews",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({authorName:m.authorName,authorRole:m.authorRole||"",titleRu:m.titleRu||"",titleUz:m.titleUz||"",textRu:m.textRu||"",textUz:m.textUz||"",rating:n(null!==(e=m.rating)&&void 0!==e?e:5),photoUrl:m.photoUrl||"",publishedAt:m.publishedAt||"",sortOrder:Number.isFinite(m.sortOrder)?m.sortOrder:0,active:m.active})}),i=await t.json().catch(()=>null);if(!t.ok){(0,s.A)((null==i?void 0:i.error)||"Ошибка сохранения","error");return}(null==i?void 0:i.row)&&(a(e=>[...e,i.row]),h({authorName:"",authorRole:"",titleRu:"",titleUz:"",textRu:"",textUz:"",rating:5,photoUrl:"",publishedAt:"",sortOrder:0,active:!0}),c(null)),(0,s.A)("Отзыв добавлен")}catch(e){(0,s.A)("Ошибка сохранения","error")}}async function g(){if(r){u(!0);try{let e=new FormData;e.append("file",r);let a=await fetch("/api/admin/reviews/upload",{method:"POST",body:e}),t=await a.json().catch(()=>null);if(!a.ok){(0,s.A)((null==t?void 0:t.error)||"Ошибка загрузки","error");return}(null==t?void 0:t.url)&&h(e=>({...e,photoUrl:t.url})),(0,s.A)("Фото загружено")}catch(e){(0,s.A)("Ошибка загрузки","error")}finally{u(!1)}}}return(0,i.jsxs)("div",{className:"admin-container stack-lg",children:[(0,i.jsxs)("div",{className:"stack",children:[(0,i.jsx)("h1",{className:"admin-title",children:"Отзывы"}),(0,i.jsx)("p",{className:"admin-subtitle",children:"Добавляйте отзывы для отображения на сайте."})]}),(0,i.jsxs)("section",{className:"admin-card stack",children:[(0,i.jsx)("div",{style:{fontWeight:600},children:"Новый отзыв"}),(0,i.jsxs)("div",{className:"admin-grid",children:[(0,i.jsxs)("div",{className:"admin-card stack",style:{boxShadow:"none"},children:[(0,i.jsxs)("label",{className:"admin-field",children:["Имя",(0,i.jsx)("input",{className:"admin-input",value:m.authorName,onChange:e=>h(a=>({...a,authorName:e.target.value})),placeholder:"Имя клиента"})]}),(0,i.jsxs)("label",{className:"admin-field",children:["Роль/город (опционально)",(0,i.jsx)("input",{className:"admin-input",value:m.authorRole,onChange:e=>h(a=>({...a,authorRole:e.target.value})),placeholder:"Ташкент"})]}),(0,i.jsxs)("label",{className:"admin-field",children:["Рейтинг (1-5)",(0,i.jsx)("input",{className:"admin-input",type:"number",min:1,max:5,value:m.rating,onChange:e=>h(a=>({...a,rating:n(e.target.value)}))})]}),(0,i.jsxs)("label",{className:"admin-field",children:["Дата",(0,i.jsx)("input",{className:"admin-input",type:"date",value:m.publishedAt,onChange:e=>h(a=>({...a,publishedAt:e.target.value}))})]})]}),(0,i.jsxs)("div",{className:"admin-card stack",style:{boxShadow:"none"},children:[(0,i.jsxs)("label",{className:"admin-field",children:["Фото (URL)",(0,i.jsx)("input",{className:"admin-input",value:m.photoUrl,onChange:e=>h(a=>({...a,photoUrl:e.target.value})),placeholder:"/uploads/reviews/..."})]}),(0,i.jsx)("div",{className:"admin-thumb",style:{width:120,height:120},children:m.photoUrl?(0,i.jsx)("img",{src:m.photoUrl,alt:"review",loading:"lazy"}):(0,i.jsx)("div",{className:"admin-thumb__empty",children:"Нет фото"})}),(0,i.jsxs)("label",{className:"admin-field",children:["Или загрузить файл",(0,i.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var a;return c((null===(a=e.target.files)||void 0===a?void 0:a[0])||null)}})]}),(0,i.jsx)("button",{className:"admin-button",disabled:o||!r,onClick:g,children:o?"...":"Загрузить"}),(0,i.jsxs)("label",{className:"admin-field",children:["Порядок",(0,i.jsx)("input",{className:"admin-input",type:"number",value:m.sortOrder,onChange:e=>h(a=>({...a,sortOrder:Number(e.target.value)}))})]}),(0,i.jsxs)("label",{className:"admin-field",style:{flexDirection:"row",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsx)("span",{children:"Активен"}),(0,i.jsx)("input",{type:"checkbox",checked:m.active,onChange:e=>h(a=>({...a,active:e.target.checked}))})]})]})]}),(0,i.jsxs)("div",{className:"admin-grid",children:[(0,i.jsxs)("div",{className:"admin-card stack",style:{boxShadow:"none"},children:[(0,i.jsx)("div",{style:{fontWeight:600},children:"RU"}),(0,i.jsxs)("label",{className:"admin-field",children:["Заголовок",(0,i.jsx)("input",{className:"admin-input",value:m.titleRu,onChange:e=>h(a=>({...a,titleRu:e.target.value})),placeholder:"Лучшие роллы"})]}),(0,i.jsxs)("label",{className:"admin-field",children:["Текст",(0,i.jsx)("textarea",{className:"admin-textarea",value:m.textRu,onChange:e=>h(a=>({...a,textRu:e.target.value}))})]})]}),(0,i.jsxs)("div",{className:"admin-card stack",style:{boxShadow:"none"},children:[(0,i.jsx)("div",{style:{fontWeight:600},children:"UZ"}),(0,i.jsxs)("label",{className:"admin-field",children:["Sarlavha",(0,i.jsx)("input",{className:"admin-input",value:m.titleUz,onChange:e=>h(a=>({...a,titleUz:e.target.value})),placeholder:"Eng yaxshi rollar"})]}),(0,i.jsxs)("label",{className:"admin-field",children:["Matn",(0,i.jsx)("textarea",{className:"admin-textarea",value:m.textUz,onChange:e=>h(a=>({...a,textUz:e.target.value}))})]})]})]}),(0,i.jsx)("button",{className:"admin-button",disabled:!m.authorName,onClick:j,children:"Добавить отзыв"})]}),(0,i.jsxs)("section",{className:"admin-card stack",children:[(0,i.jsx)("div",{style:{fontWeight:600},children:"Список отзывов"}),(0,i.jsx)("div",{className:"stack",children:x.map(e=>(0,i.jsxs)("div",{className:"admin-card stack",style:{boxShadow:"none"},children:[(0,i.jsxs)("div",{className:"admin-inline",children:[(0,i.jsxs)("div",{className:"admin-subtitle",children:["ID: ",e.id]}),(0,i.jsx)("div",{className:"admin-pill",children:e.active?"Активен":"Скрыт"})]}),(0,i.jsxs)("div",{className:"admin-grid",children:[(0,i.jsxs)("div",{className:"admin-card stack",style:{boxShadow:"none"},children:[(0,i.jsxs)("label",{className:"admin-field",children:["Имя",(0,i.jsx)("input",{className:"admin-input",value:e.authorName,onChange:a=>v(e.id,{authorName:a.target.value})})]}),(0,i.jsxs)("label",{className:"admin-field",children:["Роль/город",(0,i.jsx)("input",{className:"admin-input",value:e.authorRole||"",onChange:a=>v(e.id,{authorRole:a.target.value})})]}),(0,i.jsxs)("label",{className:"admin-field",children:["Рейтинг",(0,i.jsx)("input",{className:"admin-input",type:"number",min:1,max:5,value:e.rating,onChange:a=>v(e.id,{rating:n(a.target.value)})})]}),(0,i.jsxs)("label",{className:"admin-field",children:["Дата",(0,i.jsx)("input",{className:"admin-input",type:"date",value:function(e){if(!e)return"";let a=new Date(e);return Number.isNaN(a.getTime())?"":a.toISOString().slice(0,10)}(e.publishedAt||e.createdAt),onChange:a=>v(e.id,{publishedAt:a.target.value})})]})]}),(0,i.jsxs)("div",{className:"admin-card stack",style:{boxShadow:"none"},children:[(0,i.jsx)("div",{className:"admin-thumb",style:{width:120,height:120},children:e.photoUrl?(0,i.jsx)("img",{src:e.photoUrl,alt:"review",loading:"lazy"}):(0,i.jsx)("div",{className:"admin-thumb__empty",children:"Нет фото"})}),(0,i.jsxs)("label",{className:"admin-field",children:["Фото (URL)",(0,i.jsx)("input",{className:"admin-input",value:e.photoUrl||"",onChange:a=>v(e.id,{photoUrl:a.target.value})})]}),(0,i.jsxs)("label",{className:"admin-field",children:["Порядок",(0,i.jsx)("input",{className:"admin-input",type:"number",value:e.sortOrder,onChange:a=>v(e.id,{sortOrder:Number(a.target.value)})})]}),(0,i.jsxs)("label",{className:"admin-field",style:{flexDirection:"row",alignItems:"center",justifyContent:"space-between"},children:[(0,i.jsx)("span",{children:"Активен"}),(0,i.jsx)("input",{type:"checkbox",checked:e.active,onChange:a=>v(e.id,{active:a.target.checked})})]})]})]}),(0,i.jsxs)("div",{className:"admin-grid",children:[(0,i.jsxs)("div",{className:"admin-card stack",style:{boxShadow:"none"},children:[(0,i.jsx)("div",{style:{fontWeight:600},children:"RU"}),(0,i.jsxs)("label",{className:"admin-field",children:["Заголовок",(0,i.jsx)("input",{className:"admin-input",value:e.titleRu||"",onChange:a=>v(e.id,{titleRu:a.target.value})})]}),(0,i.jsxs)("label",{className:"admin-field",children:["Текст",(0,i.jsx)("textarea",{className:"admin-textarea",value:e.textRu||"",onChange:a=>v(e.id,{textRu:a.target.value})})]})]}),(0,i.jsxs)("div",{className:"admin-card stack",style:{boxShadow:"none"},children:[(0,i.jsx)("div",{style:{fontWeight:600},children:"UZ"}),(0,i.jsxs)("label",{className:"admin-field",children:["Sarlavha",(0,i.jsx)("input",{className:"admin-input",value:e.titleUz||"",onChange:a=>v(e.id,{titleUz:a.target.value})})]}),(0,i.jsxs)("label",{className:"admin-field",children:["Matn",(0,i.jsx)("textarea",{className:"admin-textarea",value:e.textUz||"",onChange:a=>v(e.id,{textUz:a.target.value})})]})]})]}),(0,i.jsxs)("div",{className:"admin-inline",children:[(0,i.jsx)("button",{className:"admin-button",disabled:t===e.id,onClick:()=>p(e),children:t===e.id?"...":"Сохранить"}),(0,i.jsx)("button",{className:"admin-button admin-button-muted",onClick:()=>N(e.id),children:"Удалить"})]})]},e.id))})]})]})}},1835:(e,a,t)=>{Promise.resolve().then(t.bind(t,714))},5299:(e,a,t)=>{"use strict";t.d(a,{A:()=>l,r:()=>i});let i="admin-toast";function l(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2400;window.dispatchEvent(new CustomEvent(i,{detail:{message:e,tone:a,duration:t}}))}}},e=>{var a=a=>e(e.s=a);e.O(0,[8441,6587,7358],()=>a(1835)),_N_E=e.O()}]);