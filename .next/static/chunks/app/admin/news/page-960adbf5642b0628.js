(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[720],{1002:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>c});var i=s(5155),l=s(2115),t=s(5299);let n={slug:"",imageUrl:"",titleRu:"",titleUz:"",excerptRu:"",excerptUz:"",bodyRu:"",bodyUz:"",seoTitleRu:"",seoDescriptionRu:"",seoKeywordsRu:"",seoTitleUz:"",seoDescriptionUz:"",seoKeywordsUz:"",publishedAt:"",active:!0};function d(e){if(!e)return"";let a=new Date(e);return Number.isNaN(a.getTime())?"":a.toISOString().slice(0,10)}function r(e){return e.trim().toLowerCase().replace(RegExp("[^\\p{L}\\p{N}\\s-]+","gu"),"").replace(/\s+/g,"-").replace(/-+/g,"-")}function c(){let[e,a]=(0,l.useState)([]),[s,c]=(0,l.useState)(null),[o,u]=(0,l.useState)(null),[m,h]=(0,l.useState)(!1),[x,p]=(0,l.useState)(n);(0,l.useEffect)(()=>{fetch("/api/admin/news").then(e=>e.json()).then(e=>{a(Array.isArray(e)?e.map(e=>({...e,publishedAt:d(e.publishedAt)})):[])})},[]);let v=(0,l.useMemo)(()=>e.slice().sort((e,a)=>{let s=e.publishedAt?new Date(e.publishedAt).getTime():0,i=a.publishedAt?new Date(a.publishedAt).getTime():0;return s!==i?i-s:a.id-e.id}),[e]);function g(e,s){a(a=>a.map(a=>a.id===e?{...a,...s}:a))}async function j(e){c(e.id);try{let s=await fetch("/api/admin/news",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({id:e.id,slug:r(e.slug),imageUrl:e.imageUrl,titleRu:e.titleRu,titleUz:e.titleUz,excerptRu:e.excerptRu,excerptUz:e.excerptUz,bodyRu:e.bodyRu,bodyUz:e.bodyUz,seoTitleRu:e.seoTitleRu||"",seoDescriptionRu:e.seoDescriptionRu||"",seoKeywordsRu:e.seoKeywordsRu||"",seoTitleUz:e.seoTitleUz||"",seoDescriptionUz:e.seoDescriptionUz||"",seoKeywordsUz:e.seoKeywordsUz||"",publishedAt:e.publishedAt||"",active:e.active})}),i=await s.json().catch(()=>null);if(!s.ok){let e=(null==i?void 0:i.error)==="SLUG_TAKEN"?"Слаг уже используется":(null==i?void 0:i.error)==="INVALID_SLUG"?"Некорректный слаг":(null==i?void 0:i.error)||"Ошибка сохранения";(0,t.A)(e,"error");return}if(null==i?void 0:i.row){let s={...i.row,publishedAt:d(i.row.publishedAt)};a(a=>a.map(a=>a.id===e.id?s:a))}(0,t.A)("Новость сохранена")}catch(e){(0,t.A)("Ошибка сохранения","error")}finally{c(null)}}async function N(e){try{let s=await fetch("/api/admin/news?id=".concat(e),{method:"DELETE"}),i=await s.json().catch(()=>null);if(!s.ok){(0,t.A)((null==i?void 0:i.error)||"Ошибка удаления","error");return}a(a=>a.filter(a=>a.id!==e)),(0,t.A)("Новость удалена")}catch(e){(0,t.A)("Ошибка удаления","error")}}async function b(){if(x.slug&&x.titleRu&&x.titleUz)try{let e=await fetch("/api/admin/news",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({slug:r(x.slug),imageUrl:x.imageUrl,titleRu:x.titleRu,titleUz:x.titleUz,excerptRu:x.excerptRu,excerptUz:x.excerptUz,bodyRu:x.bodyRu,bodyUz:x.bodyUz,seoTitleRu:x.seoTitleRu||"",seoDescriptionRu:x.seoDescriptionRu||"",seoKeywordsRu:x.seoKeywordsRu||"",seoTitleUz:x.seoTitleUz||"",seoDescriptionUz:x.seoDescriptionUz||"",seoKeywordsUz:x.seoKeywordsUz||"",publishedAt:x.publishedAt||"",active:x.active})}),s=await e.json().catch(()=>null);if(!e.ok){let e=(null==s?void 0:s.error)==="SLUG_TAKEN"?"Слаг уже используется":(null==s?void 0:s.error)==="INVALID_SLUG"?"Некорректный слаг":(null==s?void 0:s.error)||"Ошибка сохранения";(0,t.A)(e,"error");return}(null==s?void 0:s.row)&&(a(e=>[...e,{...s.row,publishedAt:d(s.row.publishedAt)}]),p(n),u(null)),(0,t.A)("Новость добавлена")}catch(e){(0,t.A)("Ошибка сохранения","error")}}async function y(){if(o){h(!0);try{let e=new FormData;e.append("file",o);let a=await fetch("/api/admin/news/upload",{method:"POST",body:e}),s=await a.json().catch(()=>null);if(!a.ok){(0,t.A)((null==s?void 0:s.error)||"Ошибка загрузки","error");return}(null==s?void 0:s.url)&&p(e=>({...e,imageUrl:s.url})),(0,t.A)("Фото загружено")}catch(e){(0,t.A)("Ошибка загрузки","error")}finally{h(!1)}}}return(0,i.jsxs)("div",{className:"admin-container stack-lg",children:[(0,i.jsxs)("div",{className:"stack",children:[(0,i.jsx)("h1",{className:"admin-title",children:"Новости"}),(0,i.jsx)("p",{className:"admin-subtitle",children:"Добавляйте новости на двух языках и SEO для карточек."})]}),(0,i.jsxs)("section",{className:"admin-card stack",children:[(0,i.jsx)("div",{style:{fontWeight:600},children:"Новая новость"}),(0,i.jsxs)("div",{className:"admin-grid",children:[(0,i.jsxs)("div",{className:"admin-card stack",style:{boxShadow:"none"},children:[(0,i.jsxs)("label",{className:"admin-field",children:["Слаг (URL)",(0,i.jsx)("input",{className:"admin-input",value:x.slug,onChange:e=>p(a=>({...a,slug:e.target.value})),placeholder:"новость-1"})]}),(0,i.jsxs)("label",{className:"admin-field",children:["Изображение (URL)",(0,i.jsx)("input",{className:"admin-input",value:x.imageUrl,onChange:e=>p(a=>({...a,imageUrl:e.target.value})),placeholder:"/uploads/news/..."})]}),(0,i.jsx)("div",{className:"admin-thumb",style:{width:"100%",height:160},children:x.imageUrl?(0,i.jsx)("img",{src:x.imageUrl,alt:"",style:{width:"100%",height:"100%",objectFit:"cover"}}):(0,i.jsx)("div",{className:"admin-thumb__empty",children:"Нет фото"})}),(0,i.jsxs)("label",{className:"admin-field",children:["Загрузка изображения",(0,i.jsx)("input",{className:"admin-input",type:"file",accept:"image/*",onChange:e=>{var a,s;return u(null!==(s=null===(a=e.target.files)||void 0===a?void 0:a[0])&&void 0!==s?s:null)}})]}),(0,i.jsx)("button",{className:"admin-button",disabled:m||!o,onClick:y,children:m?"Загрузка...":"Загрузить фото"}),(0,i.jsxs)("label",{className:"admin-field",children:["Дата публикации",(0,i.jsx)("input",{className:"admin-input",type:"date",value:x.publishedAt||"",onChange:e=>p(a=>({...a,publishedAt:e.target.value}))})]}),(0,i.jsx)("label",{className:"admin-field",children:(0,i.jsxs)("span",{className:"admin-inline",style:{gap:8},children:[(0,i.jsx)("input",{type:"checkbox",checked:x.active,onChange:e=>p(a=>({...a,active:e.target.checked}))}),"Активна"]})})]}),(0,i.jsxs)("div",{className:"admin-card stack",style:{boxShadow:"none"},children:[(0,i.jsx)("div",{style:{fontWeight:600},children:"Русский"}),(0,i.jsxs)("label",{className:"admin-field",children:["Заголовок",(0,i.jsx)("input",{className:"admin-input",value:x.titleRu,onChange:e=>p(a=>({...a,titleRu:e.target.value}))})]}),(0,i.jsxs)("label",{className:"admin-field",children:["Короткое описание",(0,i.jsx)("textarea",{className:"admin-textarea",rows:3,value:x.excerptRu,onChange:e=>p(a=>({...a,excerptRu:e.target.value}))})]}),(0,i.jsxs)("label",{className:"admin-field",children:["Полный текст",(0,i.jsx)("textarea",{className:"admin-textarea",rows:6,value:x.bodyRu,onChange:e=>p(a=>({...a,bodyRu:e.target.value}))})]}),(0,i.jsx)("div",{className:"admin-divider"}),(0,i.jsxs)("label",{className:"admin-field",children:["SEO title",(0,i.jsx)("input",{className:"admin-input",value:x.seoTitleRu||"",onChange:e=>p(a=>({...a,seoTitleRu:e.target.value}))})]}),(0,i.jsxs)("label",{className:"admin-field",children:["SEO description",(0,i.jsx)("textarea",{className:"admin-textarea",rows:2,value:x.seoDescriptionRu||"",onChange:e=>p(a=>({...a,seoDescriptionRu:e.target.value}))})]}),(0,i.jsxs)("label",{className:"admin-field",children:["SEO keywords",(0,i.jsx)("input",{className:"admin-input",value:x.seoKeywordsRu||"",onChange:e=>p(a=>({...a,seoKeywordsRu:e.target.value}))})]})]}),(0,i.jsxs)("div",{className:"admin-card stack",style:{boxShadow:"none"},children:[(0,i.jsx)("div",{style:{fontWeight:600},children:"O'zbekcha"}),(0,i.jsxs)("label",{className:"admin-field",children:["Sarlavha",(0,i.jsx)("input",{className:"admin-input",value:x.titleUz,onChange:e=>p(a=>({...a,titleUz:e.target.value}))})]}),(0,i.jsxs)("label",{className:"admin-field",children:["Qisqa tavsif",(0,i.jsx)("textarea",{className:"admin-textarea",rows:3,value:x.excerptUz,onChange:e=>p(a=>({...a,excerptUz:e.target.value}))})]}),(0,i.jsxs)("label",{className:"admin-field",children:["To'liq matn",(0,i.jsx)("textarea",{className:"admin-textarea",rows:6,value:x.bodyUz,onChange:e=>p(a=>({...a,bodyUz:e.target.value}))})]}),(0,i.jsx)("div",{className:"admin-divider"}),(0,i.jsxs)("label",{className:"admin-field",children:["SEO title",(0,i.jsx)("input",{className:"admin-input",value:x.seoTitleUz||"",onChange:e=>p(a=>({...a,seoTitleUz:e.target.value}))})]}),(0,i.jsxs)("label",{className:"admin-field",children:["SEO description",(0,i.jsx)("textarea",{className:"admin-textarea",rows:2,value:x.seoDescriptionUz||"",onChange:e=>p(a=>({...a,seoDescriptionUz:e.target.value}))})]}),(0,i.jsxs)("label",{className:"admin-field",children:["SEO keywords",(0,i.jsx)("input",{className:"admin-input",value:x.seoKeywordsUz||"",onChange:e=>p(a=>({...a,seoKeywordsUz:e.target.value}))})]})]})]}),(0,i.jsx)("button",{className:"admin-button",disabled:!x.slug||!x.imageUrl||!x.titleRu||!x.titleUz||!x.excerptRu||!x.excerptUz||!x.bodyRu||!x.bodyUz,onClick:b,children:"Добавить новость"})]}),(0,i.jsxs)("section",{className:"admin-card stack",children:[(0,i.jsx)("div",{style:{fontWeight:600},children:"Список новостей"}),0===v.length?(0,i.jsx)("div",{className:"admin-subtitle",children:"Пока нет ни одной новости."}):(0,i.jsx)("div",{className:"stack",children:v.map(e=>(0,i.jsxs)("div",{className:"admin-card stack",style:{boxShadow:"none"},children:[(0,i.jsxs)("div",{className:"admin-inline",children:[(0,i.jsxs)("div",{className:"admin-subtitle",children:["ID: ",e.id]}),(0,i.jsx)("div",{className:"admin-pill",children:e.active?"Активна":"Скрыта"}),(0,i.jsx)("div",{className:"admin-subtitle",children:e.slug})]}),(0,i.jsxs)("div",{className:"admin-grid",children:[(0,i.jsxs)("div",{className:"admin-card stack",style:{boxShadow:"none"},children:[(0,i.jsxs)("label",{className:"admin-field",children:["Слаг (URL)",(0,i.jsx)("input",{className:"admin-input",value:e.slug,onChange:a=>g(e.id,{slug:a.target.value})})]}),(0,i.jsxs)("label",{className:"admin-field",children:["Изображение (URL)",(0,i.jsx)("input",{className:"admin-input",value:e.imageUrl,onChange:a=>g(e.id,{imageUrl:a.target.value})})]}),(0,i.jsx)("div",{className:"admin-thumb",style:{width:"100%",height:140},children:e.imageUrl?(0,i.jsx)("img",{src:e.imageUrl,alt:"",style:{width:"100%",height:"100%",objectFit:"cover"}}):(0,i.jsx)("div",{className:"admin-thumb__empty",children:"Нет фото"})}),(0,i.jsxs)("label",{className:"admin-field",children:["Дата публикации",(0,i.jsx)("input",{className:"admin-input",type:"date",value:e.publishedAt||"",onChange:a=>g(e.id,{publishedAt:a.target.value})})]}),(0,i.jsx)("label",{className:"admin-field",children:(0,i.jsxs)("span",{className:"admin-inline",style:{gap:8},children:[(0,i.jsx)("input",{type:"checkbox",checked:e.active,onChange:a=>g(e.id,{active:a.target.checked})}),"Активна"]})})]}),(0,i.jsxs)("div",{className:"admin-card stack",style:{boxShadow:"none"},children:[(0,i.jsx)("div",{style:{fontWeight:600},children:"RU"}),(0,i.jsxs)("label",{className:"admin-field",children:["Заголовок",(0,i.jsx)("input",{className:"admin-input",value:e.titleRu,onChange:a=>g(e.id,{titleRu:a.target.value})})]}),(0,i.jsxs)("label",{className:"admin-field",children:["Описание",(0,i.jsx)("textarea",{className:"admin-textarea",rows:3,value:e.excerptRu,onChange:a=>g(e.id,{excerptRu:a.target.value})})]}),(0,i.jsxs)("label",{className:"admin-field",children:["Полный текст",(0,i.jsx)("textarea",{className:"admin-textarea",rows:6,value:e.bodyRu,onChange:a=>g(e.id,{bodyRu:a.target.value})})]}),(0,i.jsx)("div",{className:"admin-divider"}),(0,i.jsxs)("label",{className:"admin-field",children:["SEO title",(0,i.jsx)("input",{className:"admin-input",value:e.seoTitleRu||"",onChange:a=>g(e.id,{seoTitleRu:a.target.value})})]}),(0,i.jsxs)("label",{className:"admin-field",children:["SEO description",(0,i.jsx)("textarea",{className:"admin-textarea",rows:2,value:e.seoDescriptionRu||"",onChange:a=>g(e.id,{seoDescriptionRu:a.target.value})})]}),(0,i.jsxs)("label",{className:"admin-field",children:["SEO keywords",(0,i.jsx)("input",{className:"admin-input",value:e.seoKeywordsRu||"",onChange:a=>g(e.id,{seoKeywordsRu:a.target.value})})]})]}),(0,i.jsxs)("div",{className:"admin-card stack",style:{boxShadow:"none"},children:[(0,i.jsx)("div",{style:{fontWeight:600},children:"UZ"}),(0,i.jsxs)("label",{className:"admin-field",children:["Sarlavha",(0,i.jsx)("input",{className:"admin-input",value:e.titleUz,onChange:a=>g(e.id,{titleUz:a.target.value})})]}),(0,i.jsxs)("label",{className:"admin-field",children:["Tavsif",(0,i.jsx)("textarea",{className:"admin-textarea",rows:3,value:e.excerptUz,onChange:a=>g(e.id,{excerptUz:a.target.value})})]}),(0,i.jsxs)("label",{className:"admin-field",children:["To'liq matn",(0,i.jsx)("textarea",{className:"admin-textarea",rows:6,value:e.bodyUz,onChange:a=>g(e.id,{bodyUz:a.target.value})})]}),(0,i.jsx)("div",{className:"admin-divider"}),(0,i.jsxs)("label",{className:"admin-field",children:["SEO title",(0,i.jsx)("input",{className:"admin-input",value:e.seoTitleUz||"",onChange:a=>g(e.id,{seoTitleUz:a.target.value})})]}),(0,i.jsxs)("label",{className:"admin-field",children:["SEO description",(0,i.jsx)("textarea",{className:"admin-textarea",rows:2,value:e.seoDescriptionUz||"",onChange:a=>g(e.id,{seoDescriptionUz:a.target.value})})]}),(0,i.jsxs)("label",{className:"admin-field",children:["SEO keywords",(0,i.jsx)("input",{className:"admin-input",value:e.seoKeywordsUz||"",onChange:a=>g(e.id,{seoKeywordsUz:a.target.value})})]})]})]}),(0,i.jsxs)("div",{className:"admin-inline",children:[(0,i.jsx)("button",{className:"admin-button",disabled:s===e.id,onClick:()=>j(e),children:s===e.id?"Сохраняю...":"Сохранить"}),(0,i.jsx)("button",{className:"admin-button admin-button-muted",onClick:()=>N(e.id),children:"Удалить"})]})]},e.id))})]})]})}},5299:(e,a,s)=>{"use strict";s.d(a,{A:()=>l,r:()=>i});let i="admin-toast";function l(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2400;window.dispatchEvent(new CustomEvent(i,{detail:{message:e,tone:a,duration:s}}))}},5569:(e,a,s)=>{Promise.resolve().then(s.bind(s,1002))}},e=>{var a=a=>e(e.s=a);e.O(0,[8441,6587,7358],()=>a(5569)),_N_E=e.O()}]);