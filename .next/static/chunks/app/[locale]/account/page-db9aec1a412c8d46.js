(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4609],{4112:(e,a,t)=>{"use strict";t.d(a,{Zd:()=>i});let l=["ru","uz"];function i(e){return l.includes(e)}},6046:(e,a,t)=>{"use strict";var l=t(6658);t.o(l,"useParams")&&t.d(a,{useParams:function(){return l.useParams}}),t.o(l,"usePathname")&&t.d(a,{usePathname:function(){return l.usePathname}}),t.o(l,"useRouter")&&t.d(a,{useRouter:function(){return l.useRouter}}),t.o(l,"useSearchParams")&&t.d(a,{useSearchParams:function(){return l.useSearchParams}})},7576:(e,a,t)=>{Promise.resolve().then(t.bind(t,8119))},8119:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>u});var l=t(5155),i=t(2115),n=t(6046),s=t(4348),r=t(7564),o=t(4112);let c={ru:{eyebrow:"Аккаунт",title:"Личный кабинет",subtitle:"Войдите или зарегистрируйтесь, чтобы копить бонусы.",loginTitle:"Вход",loginText:"Введите номер телефона и пароль для входа.",registerTitle:"Регистрация",registerText:"Создайте профиль и начните копить бонусы.",nameLabel:"Имя",phoneLabel:"Телефон",passwordLabel:"Пароль",birthdayLabel:"Дата рождения",loginBtn:"Войти",registerBtn:"Зарегистрироваться",profileTitle:"Профиль",bonusLabel:"Бонусы",logout:"Выйти",phonePlaceholder:"+998 90 123 45 67",namePlaceholder:"Ваше имя",passwordPlaceholder:"Введите пароль",birthdayPlaceholder:"1995-05-20",clientNotFound:"Клиент не найден. Зарегистрируйтесь.",invalidCredentials:"Неверный номер или пароль.",clientAlreadyRegistered:"Номер уже зарегистрирован. Войдите.",invalidPhone:"Некорректный номер телефона.",passwordTooShort:"Пароль должен быть минимум 8 символов.",birthdayRequired:"Введите дату рождения для подтверждения.",birthdayMismatch:"Дата рождения не совпадает с данными в Poster."},uz:{eyebrow:"Profil",title:"Shaxsiy kabinet",subtitle:"Kirish yoki ro'yxatdan o'ting va bonuslar yig'ing.",loginTitle:"Kirish",loginText:"Kirish uchun telefon raqamingiz va parolingizni kiriting.",registerTitle:"Ro'yxatdan o'tish",registerText:"Profil yarating va bonuslar yig'ishni boshlang.",nameLabel:"Ism",phoneLabel:"Telefon",passwordLabel:"Parol",birthdayLabel:"Tug'ilgan sana",loginBtn:"Kirish",registerBtn:"Ro'yxatdan o'tish",profileTitle:"Profil",bonusLabel:"Bonuslar",logout:"Chiqish",phonePlaceholder:"+998 90 123 45 67",namePlaceholder:"Ismingiz",passwordPlaceholder:"Parolni kiriting",birthdayPlaceholder:"1995-05-20",clientNotFound:"Mijoz topilmadi. Ro'yxatdan o'ting.",invalidCredentials:"Telefon yoki parol noto'g'ri.",clientAlreadyRegistered:"Bu raqam allaqachon ro'yxatdan o'tgan. Kirishingiz mumkin.",invalidPhone:"Telefon raqami noto'g'ri.",passwordTooShort:"Parol kamida 8 ta belgidan iborat bo'lishi kerak.",birthdayRequired:"Tasdiqlash uchun tug'ilgan sanani kiriting.",birthdayMismatch:"Tug'ilgan sana Poster ma'lumotlariga mos kelmadi."}};function u(){let e=(0,n.useParams)(),a=Array.isArray(null==e?void 0:e.locale)?e.locale[0]:null==e?void 0:e.locale,t="string"==typeof a?a:"",u=(0,o.Zd)(t)?t:"ru",d="uz"===u?c.uz:c.ru,[h,m]=(0,i.useState)(null),[g,b]=(0,i.useState)(!0),[p,v]=(0,i.useState)(!1),[x,N]=(0,i.useState)(null),[y,j]=(0,i.useState)("login"),[f,P]=(0,i.useState)(""),[T,S]=(0,i.useState)(""),[w,_]=(0,i.useState)(""),[R,L]=(0,i.useState)(""),[k,C]=(0,i.useState)(""),[O,I]=(0,i.useState)("");(0,i.useEffect)(()=>{let e=!0;return b(!0),fetch("/api/auth/client/me").then(e=>e.json()).then(a=>{e&&m((null==a?void 0:a.client)||null)}).catch(()=>{e&&m(null)}).finally(()=>{e&&b(!1)}),()=>{e=!1}},[]);let A=(0,i.useMemo)(()=>(function(e,a){try{return new Intl.NumberFormat("uz"===a?"uz-UZ":"ru-RU").format(e)}catch(a){return String(e)}})((null==h?void 0:h.bonus)||0,u),[null==h?void 0:h.bonus,u]);async function E(){if(f.trim()&&T.trim()){v(!0),N(null);try{let e=await fetch("/api/auth/client/login",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({phone:f.trim(),password:T.trim()})}),a=await e.json().catch(()=>null);if(!e.ok){(null==a?void 0:a.error)==="CLIENT_NOT_FOUND"?(N(d.clientNotFound),j("register"),L(f.trim())):(null==a?void 0:a.error)==="INVALID_CREDENTIALS"?N(d.invalidCredentials):(null==a?void 0:a.error)==="INVALID_PHONE"?N(d.invalidPhone):(null==a?void 0:a.error)==="PASSWORD_TOO_SHORT"?N(d.passwordTooShort):N("Ошибка");return}m((null==a?void 0:a.client)||null)}catch(e){N("Ошибка")}finally{v(!1)}}}async function z(){if(w.trim()&&R.trim()&&k.trim()){v(!0),N(null);try{let e=await fetch("/api/auth/client/register",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({name:w.trim(),phone:R.trim(),birthday:O||"",password:k.trim()})}),a=await e.json().catch(()=>null);if(!e.ok){(null==a?void 0:a.error)==="CLIENT_ALREADY_REGISTERED"?N(d.clientAlreadyRegistered):(null==a?void 0:a.error)==="INVALID_PHONE"?N(d.invalidPhone):(null==a?void 0:a.error)==="PASSWORD_TOO_SHORT"?N(d.passwordTooShort):(null==a?void 0:a.error)==="BIRTHDAY_REQUIRED"?N(d.birthdayRequired):(null==a?void 0:a.error)==="BIRTHDAY_MISMATCH"?N(d.birthdayMismatch):N("Ошибка");return}m((null==a?void 0:a.client)||null),P(R.trim()),S(""),C("")}catch(e){N("Ошибка")}finally{v(!1)}}}async function D(){v(!0),N(null);try{await fetch("/api/auth/client/logout",{method:"POST"}),m(null)}finally{v(!1)}}return(0,l.jsxs)("div",{className:"ws-page",children:[(0,l.jsx)(s.default,{locale:u}),(0,l.jsx)("main",{className:"site-main",children:(0,l.jsx)("section",{className:"site-section",children:(0,l.jsxs)("div",{className:"ws-container",children:[(0,l.jsx)("div",{className:"site-section__head",children:(0,l.jsxs)("div",{children:[(0,l.jsx)("span",{className:"site-eyebrow",children:d.eyebrow}),(0,l.jsx)("h1",{className:"site-title",children:d.title}),(0,l.jsx)("p",{className:"site-subtitle",children:d.subtitle})]})}),g?(0,l.jsx)("div",{className:"site-card account-card",children:"uz"===u?"Yuklanmoqda...":"Загрузка..."}):h?(0,l.jsx)("div",{className:"account-grid",children:(0,l.jsxs)("div",{className:"site-card account-card account-profile",children:[(0,l.jsxs)("div",{className:"account-pill",children:["ID: ",h.id]}),(0,l.jsx)("div",{className:"account-name",children:h.name||("uz"===u?"Mehmon":"Гость")}),(0,l.jsx)("div",{className:"account-phone",children:h.phone}),(0,l.jsxs)("div",{className:"account-bonus",children:[(0,l.jsx)("span",{children:d.bonusLabel}),(0,l.jsx)("strong",{children:A})]}),x&&(0,l.jsx)("div",{className:"account-message is-error",children:x}),(0,l.jsx)("div",{className:"account-actions",children:(0,l.jsx)("button",{className:"site-button site-button--primary",disabled:p,onClick:D,children:d.logout})})]})}):(0,l.jsx)("div",{className:"account-grid",children:(0,l.jsxs)("div",{className:"site-card account-card",children:[(0,l.jsxs)("div",{className:"account-tabs",role:"tablist",children:[(0,l.jsx)("button",{type:"button",className:"account-tab".concat("login"===y?" is-active":""),onClick:()=>j("login"),children:d.loginTitle}),(0,l.jsx)("button",{type:"button",className:"account-tab".concat("register"===y?" is-active":""),onClick:()=>j("register"),children:d.registerTitle})]}),"login"===y?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"account-card__title",children:d.loginTitle}),(0,l.jsx)("div",{className:"account-card__text",children:d.loginText}),(0,l.jsxs)("label",{className:"account-field",children:[d.phoneLabel,(0,l.jsx)("input",{className:"account-input",type:"tel",inputMode:"tel",value:f,onChange:e=>P(e.target.value),placeholder:d.phonePlaceholder})]}),(0,l.jsxs)("label",{className:"account-field",children:[d.passwordLabel,(0,l.jsx)("input",{className:"account-input",type:"password",value:T,onChange:e=>S(e.target.value),placeholder:d.passwordPlaceholder})]}),x&&(0,l.jsx)("div",{className:"account-message is-error",children:x}),(0,l.jsx)("button",{className:"site-button site-button--primary",disabled:p,onClick:E,children:d.loginBtn})]}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"account-card__title",children:d.registerTitle}),(0,l.jsx)("div",{className:"account-card__text",children:d.registerText}),(0,l.jsxs)("label",{className:"account-field",children:[d.nameLabel,(0,l.jsx)("input",{className:"account-input",value:w,onChange:e=>_(e.target.value),placeholder:d.namePlaceholder})]}),(0,l.jsxs)("label",{className:"account-field",children:[d.phoneLabel,(0,l.jsx)("input",{className:"account-input",type:"tel",inputMode:"tel",value:R,onChange:e=>L(e.target.value),placeholder:d.phonePlaceholder})]}),(0,l.jsxs)("label",{className:"account-field",children:[d.passwordLabel,(0,l.jsx)("input",{className:"account-input",type:"password",value:k,onChange:e=>C(e.target.value),placeholder:d.passwordPlaceholder})]}),(0,l.jsxs)("label",{className:"account-field",children:[d.birthdayLabel,(0,l.jsx)("input",{className:"account-input",type:"date",value:O,onChange:e=>I(e.target.value),placeholder:d.birthdayPlaceholder})]}),x&&(0,l.jsx)("div",{className:"account-message is-error",children:x}),(0,l.jsx)("button",{className:"site-button site-button--ghost",disabled:p,onClick:z,children:d.registerBtn})]})]})})]})})}),(0,l.jsx)(r.default,{locale:u})]})}}},e=>{var a=a=>e(e.s=a);e.O(0,[3499,8441,6587,7358],()=>a(7576)),_N_E=e.O()}]);